<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TÃ¼rkiye MezarlÄ±klarÄ± HaritasÄ±</title>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css"
        integrity="sha512-sA+e2sU6UjeRGna43EIBgzHuLlHotE5T7V6czS4fFqqTZPIYOvToNiOfzmiEJeZVr3ePwFsypIk7wLrjCmq80Q=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-67Y2J3VKBJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-67Y2J3VKBJ');
  </script>
  <style>
    /* Temel stil */
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    #map {
      width: 100%;
      height: 70vh; /* YÃ¼kseklik tanÄ±mlÄ± */
      border-radius: 12px;
    }
    /* DiÄŸer stil kurallarÄ± (panel, form, vs) */
    /* â€¦ burada sizin Ã¶nceki stil kodunuz devam eder â€¦ */
  </style>
</head>
<body>
  <header>
    <h1>ğŸ•¯ï¸ TÃ¼rkiye MezarlÄ±klarÄ± HaritasÄ±</h1>
    <p>Wikidata Ã¼zerinde â€œcemeteryâ€ ve â€œgraveyardâ€ olarak iÅŸaretlenmiÅŸ alanlarÄ± seÃ§tiÄŸiniz ile gÃ¶re gÃ¶rÃ¼ntÃ¼leyin.</p>
  </header>
  <main>
    <section>
      <label for="provinceSelect">Ä°l seÃ§iniz:</label>
      <select id="provinceSelect" onchange="handleProvinceChange()">
        <option value="">Ä°l seÃ§inizâ€¦</option>
        <option value="Q40549">Adana</option>
        <option value="Q43924">AdÄ±yaman</option>
        <!-- â€¦ diÄŸer iller â€¦ -->
        <option value="Q534799">Ä°stanbul</option>
        <option value="Q344490">Ä°zmir</option>
      </select>
      <button onclick="loadCemeteries()">ğŸ“ Haritada GÃ¶ster</button>
    </section>
    <div id="map"></div>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"
          integrity="sha512-VzJZnN2JgsFnmpt5TR1+t0NenE2no0RvrRZtGJPD7W82dManIeZDV4SSQdlqzTeWY5Avzk1lIoasJl0f5pmQmA=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script>
  <script>
    const map = L.map('map').setView([39.0, 35.0], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors',
      maxZoom: 19
    }).addTo(map);

    map.whenReady(() => {
      map.invalidateSize();
    });

    async function loadCemeteries(){
      const province = document.getElementById('provinceSelect').value;
      if(!province){
        alert('LÃ¼tfen bir il seÃ§iniz.');
        return;
      }

      const query = `
        SELECT DISTINCT ?place ?placeLabel ?coord ?instanceLabel WHERE {
          VALUES ?instance { wd:Q39614 wd:Q1107656 }
          ?place wdt:P31 ?instance ;
                 wdt:P17 wd:Q43 ;
                 wdt:P131* wd:${province} ;
                 wdt:P625 ?coord .
          SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],tr,en". }
        }
      `;

      const url = 'https://query.wikidata.org/sparql?format=json&query=' + encodeURIComponent(query);
      try{
        const resp = await fetch(url);
        if(!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const json = await resp.json();
        const results = json.results.bindings || [];
        markersLayer.clearLayers();

        const bounds = [];
        results.forEach(r => {
          const coord = r.coord.value.match(/Point\\(([^ ]+) ([^ ]+)\\)/);
          if(!coord) return;
          const lng = parseFloat(coord[1]);
          const lat = parseFloat(coord[2]);
          bounds.push([lat,lng]);

          const marker = L.circleMarker([lat,lng], {
            radius: 6,
            fillColor: '#2563eb',
            color: '#1e40af',
            fillOpacity: 0.8,
            weight: 2
          }).addTo(markersLayer)
            .bindPopup(`${r.placeLabel.value} (${r.instanceLabel.value})`);

        });
        if(bounds.length) map.fitBounds(bounds);

      } catch(err){
        console.error(err);
        alert('Sorgu hatasÄ±: ' + err.message);
      }
    }

    const markersLayer = L.layerGroup().addTo(map);

    function handleProvinceChange(){
      // Ä°lÃ§e seÃ§imi varsa burada yapÄ±labilir
    }
  </script>
</body>
</html>
